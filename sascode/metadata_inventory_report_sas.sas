/*************************************************************************************************************/
/*  PROGRAM NAME: METADATA_INVENTORY_REPORT   	                                    						 */
/*  DATE CREATED: 31-07-2020                                                      							 */
/*  AUTHOR: GEORGE BEEVERS																					 */
/*  DESCRIPTION: This program utilises a number of macros from Alan Bowe, Michael Larson, Lewis Mitchell, 	 */ 
/*  Amit Patel and some adaptions by George Beevers	to return information from the metadata server. The 	 */
/*  process will contain information about jobs, users, roles,tables, notes, prompts, flows, cubes, 		 */
/*  stored processes, etc. 											 										 */
/*  INPUTS: SAS Metadata Server			  |              					                        		 */
/*																											 */
/*  OUTPUTS: Various SAS tables and XLSX Report                                    							 */
/* --------------------------------------------------------------------------------------------------------- */
/*  VERSION CONTROL	                         																 */
/*  Version 	Date 		Name 			Description                                 					 */
/*  1.0 		31-07-2020 	George Beevers  Iniital Release                                					 */
/* --------------------------------------------------------------------------------------------------------- */
/*============================================================================================================*/
/* SETUP REQUIREMENT				                                    								  	  */
/*============================================================================================================*/
/*------------------------------------------------------------------------------------------------------------*/
/* DESCRIPTION                                                   								  	  		  */
/* Change as per the setup you have						 													  */
/* Macro Library =  																						  */
/* Report Location =																						  */
/*------------------------------------------------------------------------------------------------------------*/
/*Change the location to point to the macros in the zip folder*/
%include "C:\temp\hsbc\meta\*";
/*============================================================================================================*/
/*  ####   ######  #####   #    #  ######  #####	|Repositories											  */
/* #       #       #    #  #    #  #       #    #	|Server Context											  */
/*  ####   #####   #    #  #    #  #####   #    #	|														  */
/*      #  #       #####   #    #  #       #####	|														  */
/* #    #  #       #   #    #  #   #       #   #	|														  */
/*  ####   ######  #    #    ##    ######  #    #	|														  */
/*============================================================================================================*/
/*============================================================================================================*/
/* EXTRACT REPOSITORIES				                                    								  	  */
/*============================================================================================================*/
/*------------------------------------------------------------------------------------------------------------*/
/* DESCRIPTION                                                   								  	  		  */
/* Extract information about available repositories (Foundation, etc)										  */
/*------------------------------------------------------------------------------------------------------------*/
%mm_getrepos(outds=work.mm_G101_repos);
/*============================================================================================================*/
/* EXTRACT SERVER CONTEXTS			                                    								  	  */
/*============================================================================================================*/
/*------------------------------------------------------------------------------------------------------------*/
/* DESCRIPTION                                                   								  	  		  */
/* Extract availabel server contexts such as SASAP, SASMETA, etc											  */
/*------------------------------------------------------------------------------------------------------------*/
%mm_getservercontexts(outds=mm_G102_server_context);
/*============================================================================================================*/
/* EXTRACT SERVER DETAILS			                                    								  	  */
/*============================================================================================================*/
/*------------------------------------------------------------------------------------------------------------*/
/* DESCRIPTION                                                   								  	  		  */
/* Extract all server details from metadata																	  */
/*------------------------------------------------------------------------------------------------------------*/
%meta_server_architecture(table=mm_G103_server_architect);

/*============================================================================================================*/
/* #####   ######   ####   #####   #       ######	|Groups													  */
/* #    #  #       #    #  #    #  #       #		|Users													  */
/* #    #  #####   #    #  #    #  #       #####	|Roles													  */
/* #####   #       #    #  #####   #       #		|AuthDomain												  */
/* #       #       #    #  #       #       #		|														  */
/* #       ######   ####   #       ######  ######	|														  */
/*============================================================================================================*/
/*============================================================================================================*/
/* EXTRACT METADATA GROUPS			                                    								  	  */
/*============================================================================================================*/
/*------------------------------------------------------------------------------------------------------------*/
/* DESCRIPTION                                                   								  	  		  */
/* Extract metadata groups																					  */
/*------------------------------------------------------------------------------------------------------------*/
%meta_extractgroups(Table=mm_G201_groups);
/*============================================================================================================*/
/* EXTRACT ALL USERS				                                    								  	  */
/*============================================================================================================*/
/*------------------------------------------------------------------------------------------------------------*/
/* DESCRIPTION                                                   								  	  		  */
/* Extract all users from metadata and show the groups they are in.											  */
/*------------------------------------------------------------------------------------------------------------*/
%meta_extractusers(Table=mm_G202_users);
/*============================================================================================================*/
/* EXTRACT ROLES IN METADATA		                                    								  	  */
/*============================================================================================================*/
/*------------------------------------------------------------------------------------------------------------*/
/* DESCRIPTION                                                   								  	  		  */
/* Extract all roles held in metadata																		  */
/*------------------------------------------------------------------------------------------------------------*/
%meta_extractroles(Table=mm_G203_roles);
/*============================================================================================================*/
/* EXTRACT AUTHDOMAIN				                                    								  	  */
/*============================================================================================================*/
/*------------------------------------------------------------------------------------------------------------*/
/* DESCRIPTION                                                   								  	  		  */
/* Extract information from metadata about AuthDomains. Results will depend on system access and encoded	  */
/* passwords may be present. Sytem level password security policies will determine what is shown. The 		  */
/* OMACONFIG.XML file will show the system policy for the metadata sever.									  */
/*------------------------------------------------------------------------------------------------------------*/
%mm_getauthinfo(outds=mm_G204_authinfo);
/*============================================================================================================*/
/* #####     ##     #####    ##		|Libraries																  */
/* #    #   #  #      #     #  #	|Directories															  */
/* #    #  #    #     #    #    #	|External Files															  */
/* #    #  ######     #    ######	|Tables																	  */
/* #    #  #    #     #    #    #	|Folders   																  */
/* #####   #    #     #    #    #	|																		  */
/*============================================================================================================*/
/*============================================================================================================*/
/* EXTRACT LIBRARIES				                                    								  	  */
/*============================================================================================================*/
/*------------------------------------------------------------------------------------------------------------*/
/* DESCRIPTION                                                   								  	  		  */
/* Extract all libraries (libnames) with fully qualified paths												  */
/*------------------------------------------------------------------------------------------------------------*/
%meta_extractlibraries(Table=mm_G301_libraries);
/*============================================================================================================*/
/* EXTARCT DIRECTORIES				                                    								  	  */
/*============================================================================================================*/
/*------------------------------------------------------------------------------------------------------------*/
/* DESCRIPTION                                                   								  	  		  */
/* Returns all registered directories from metadata															  */
/*------------------------------------------------------------------------------------------------------------*/
%meta_extractdirectories(Table=mm_G302_directories);
/*============================================================================================================*/
/* EXTRACT EXTERNAL FILES			                                    								  	  */
/*============================================================================================================*/
/*------------------------------------------------------------------------------------------------------------*/
/* DESCRIPTION                                                   								  	  		  */
/* Extract information about all external files used in DIS													  */
/*------------------------------------------------------------------------------------------------------------*/
%meta_extractexternalfiles(Table=mm_G303_externalFiles);
/*============================================================================================================*/
/* EXTRACT ALL TABLES				                                    								  	  */
/*============================================================================================================*/
/*------------------------------------------------------------------------------------------------------------*/
/* DESCRIPTION                                                   								  	  		  */
/* Extract all registered tables in metadata																  */
/*------------------------------------------------------------------------------------------------------------*/
/*EXTRACT ALL TABLES																	*/
%meta_extracttables(Table=mm_G304_tables);
/*============================================================================================================*/
/* EXTRACT METADATA FOLDERS			                                    								  	  */
/*============================================================================================================*/
/*------------------------------------------------------------------------------------------------------------*/
/* DESCRIPTION                                                   								  	  		  */
/* Extract all metadata folders																				  */
/*------------------------------------------------------------------------------------------------------------*/
%meta_extractfolders(Table=mm_G305_folders);
/*============================================================================================================*/
/*      #   ####   #####    ####	|Jobs & Tables					|User Written Transformations			  */
/*      #  #    #  #    #  #		|Jobs							|										  */
/*      #  #    #  #####    ####	|Jobs (Deployed)				|										  */
/*      #  #    #  #    #       #	|Job Transformations			|										  */
/* #    #  #    #  #    #  #    #	|Job Notes						|										  */
/*  ####    ####   #####    ####	|Job Prompts					|										  */
/*============================================================================================================*/
/*============================================================================================================*/
/* EXTRACT JOBS AND TABLES			                                    								  	  */
/*============================================================================================================*/
/*------------------------------------------------------------------------------------------------------------*/
/* DESCRIPTION                                                   								  	  		  */
/* Extract all jobs and tables 																				  */
/*------------------------------------------------------------------------------------------------------------*/
%meta_extractjobtables(Table=mm_G401_JobTables);
/*============================================================================================================*/
/* EXTRACT ALL JOB INFORMATION		                                    								  	  */
/*============================================================================================================*/
/*------------------------------------------------------------------------------------------------------------*/
/* DESCRIPTION                                                   								  	  		  */
/* Extract job information from metadata. This will include step names, taget and source tables, librefs,	  */
/* physical tables, step number in the job and transformation type											  */
/*------------------------------------------------------------------------------------------------------------*/
%meta_extractjob(table=mm_G402_jobs);
/*============================================================================================================*/
/* EXTRACT ALL JOBS, INCLUDING DEPLOYED STATUS                             								  	  */
/*============================================================================================================*/
/*------------------------------------------------------------------------------------------------------------*/
/* DESCRIPTION                                                   								  	  		  */
/* Extracts job information relating to deployment status. Details shown on jobs which have been deployed to  */
/* the batch server for processing(deploy job in DIS option)												  */
/*------------------------------------------------------------------------------------------------------------*/
%meta_extractjobs(table=MM_G403_ALL_DEP_JOBS);
/*============================================================================================================*/
/* EXTRACT JOB TRANSFORMATIONS		                                    								  	  */
/*============================================================================================================*/
/*------------------------------------------------------------------------------------------------------------*/
/* DESCRIPTION                                                   								  	  		  */
/* Extract job information showing transformations. Report shows the source and taget tables along with 	  */
/* every transformation (FileReader, SASExtract, etc)														  */
/*------------------------------------------------------------------------------------------------------------*/
%meta_extractjobtransformations(Table=mm_G404_JobTransformations);
/*============================================================================================================*/
/* EXTRACT JOB NOTES				                                    								  	  */
/*============================================================================================================*/
/*------------------------------------------------------------------------------------------------------------*/
/* DESCRIPTION                                                   								  	  		  */
/* Extract DIS job notes																					  */
/*------------------------------------------------------------------------------------------------------------*/
%meta_extractnotes(OutDsn=mm_G405_Notes);
/*============================================================================================================*/
/* EXTRACT JOB PROMPTS				                                    								  	  */
/*============================================================================================================*/
/*------------------------------------------------------------------------------------------------------------*/
/* DESCRIPTION                                                   								  	  		  */
/* Extract job prompts																						  */
/*------------------------------------------------------------------------------------------------------------*/
%meta_extractprompts(Table=mm_G406_Prompts);
/*============================================================================================================*/
/* EXTRACT USER WRITTEN TRANSFORMATIONS                                   								  	  */
/*============================================================================================================*/
/*------------------------------------------------------------------------------------------------------------*/
/* DESCRIPTION                                                   								  	  		  */
/* Extract all user written transformations																	  */
/*------------------------------------------------------------------------------------------------------------*/
%meta_extractuwtransformations(Table=mm_G407_UWTransformations);
/*============================================================================================================*/
/*  ####    #####  #    #  ######  #####	|Enterprise Miner												  */
/* #    #     #    #    #  #       #    #	|Cubes														      */
/* #    #     #    ######  #####   #    #	|Visual Analytics												  */
/* #    #     #    #    #  #       #####	|Information Maps												  */
/* #    #     #    #    #  #       #   #	|Stored Processes												  */
/*  ####      #    #    #  ######  #    #	|Reports														  */
/*============================================================================================================*/
/*============================================================================================================*/
/* EXTRACT ENTERPRISE MINER MODEL INFORMATION                              								  	  */
/*============================================================================================================*/
/*------------------------------------------------------------------------------------------------------------*/
/* DESCRIPTION                                                   								  	  		  */
/* Extract information related to EMiner models registered in metadata										  */
/*------------------------------------------------------------------------------------------------------------*/
%meta_extractminingresults(Table=mm_G501_MiningResults);
/*============================================================================================================*/
/* EXTRACT CUBES					                                    								  	  */
/*============================================================================================================*/
/*------------------------------------------------------------------------------------------------------------*/
/* DESCRIPTION                                                   								  	  		  */
/* Extract all information about cubes held in metadata														  */
/*------------------------------------------------------------------------------------------------------------*/
%meta_extractcubes(Table=mm_G502_Cubes);
/*============================================================================================================*/
/* EXTRACT VISUAL ANALYTICS INFORMATION                                    								  	  */
/*============================================================================================================*/
/*------------------------------------------------------------------------------------------------------------*/
/* DESCRIPTION                                                   								  	  		  */
/* Extract information about Visual Analytics reports														  */
/*------------------------------------------------------------------------------------------------------------*/
%meta_extractvaexplorations(Table=mm_G503_VAExplorations);
/*============================================================================================================*/
/* EXTRACT INFORMATION MAPS			                                    								  	  */
/*============================================================================================================*/
/*------------------------------------------------------------------------------------------------------------*/
/* DESCRIPTION                                                   								  	  		  */
/* Exttract information maps from metadata																	  */
/*------------------------------------------------------------------------------------------------------------*/
%meta_extractinfomaps(Table=mm_G504_InfoMaps);
/*============================================================================================================*/
/* EXTRACT STORED PROCESSES			                                    								  	  */
/*============================================================================================================*/
/*------------------------------------------------------------------------------------------------------------*/
/* DESCRIPTION                                                   								  	  		  */
/* Extract information about stored processes																  */
/*------------------------------------------------------------------------------------------------------------*/
%meta_extractstoredprocesses(Table=mm_G505_StoredProcesses);
/*============================================================================================================*/
/* EXTRACT REPORTS					                                    								  	  */
/*============================================================================================================*/
/*------------------------------------------------------------------------------------------------------------*/
/* DESCRIPTION                                                   								  	  		  */
/* Extract information about reports in metadata															  */
/*------------------------------------------------------------------------------------------------------------*/
%meta_extractreports(Table=mm_G506_Reports);
/*============================================================================================================*/
/* EXTRACT TRANSFORMROLES			                                    								  	  */
/*============================================================================================================*/
/*------------------------------------------------------------------------------------------------------------*/
/* DESCRIPTION                                                   								  	  		  */
/* Extract transformroles which have been used on DIS jobs													  */
/*------------------------------------------------------------------------------------------------------------*/
%get_job_transformrole_det(table=mm_G507_job_transformrole);
/*============================================================================================================*/
/* EXTRACT JOB SOURCE CODE			                                    								  	  */
/*============================================================================================================*/
/*------------------------------------------------------------------------------------------------------------*/
/* DESCRIPTION                                                   								  	  		  */
/* Extract transformroles which have been used on DIS jobs													  */
/*------------------------------------------------------------------------------------------------------------*/
%meta_get_user_code(table=mm_G508_job_sourcecode);
/*============================================================================================================*/
/* EXTRACT PRE AND POST CODE		                                    								  	  */
/*============================================================================================================*/
/*------------------------------------------------------------------------------------------------------------*/
/* DESCRIPTION                                                   								  	  		  */
/* Extract transformroles which have been used on DIS jobs													  */
/*------------------------------------------------------------------------------------------------------------*/
%get_pre_post_code(trantype=TransformationSources,table=mm_G509_PRECODE);
%get_pre_post_code(trantype=TransformationTargets,table=mm_G509_POSTCODE);
/*%get_pre_post_code(trantype=TransformationSources);*/
/*%get_pre_post_code(trantype=TransformationTargets);*/
proc datasets lib=work;
delete _:;
delete repos;
run;

